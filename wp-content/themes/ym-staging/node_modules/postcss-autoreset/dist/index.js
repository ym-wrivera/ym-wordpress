'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _postcss = require('postcss');

var _postcss2 = _interopRequireDefault(_postcss);

var _rulesMatcher = require('./rulesMatcher');

var _rulesMatcher2 = _interopRequireDefault(_rulesMatcher);

var _resetRules = require('./resetRules');

var _resetRules2 = _interopRequireDefault(_resetRules);

var _createResetRule = require('./createResetRule');

var _createResetRule2 = _interopRequireDefault(_createResetRule);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var contains = function contains(array, item) {
  return array.indexOf(item) !== -1;
};

exports.default = _postcss2.default.plugin('postcss-autoreset', function () {
  var opts = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

  opts.rulesMatcher = opts.rulesMatcher || 'bem';
  opts.reset = opts.reset || 'initial';
  var rulesMatcher = (0, _rulesMatcher2.default)(opts.rulesMatcher);
  var reset = (0, _resetRules2.default)(opts.reset);
  return function (css) {
    var matchedSelectors = [];
    css.walkRules(function (rule) {
      var selector = rule.selector;

      if (!contains(matchedSelectors, selector) && rulesMatcher(rule)) {
        matchedSelectors.push(selector);
      }
    });
    if (!matchedSelectors.length) return;
    css.prepend((0, _createResetRule2.default)(matchedSelectors, reset));
  };
});
module.exports = exports['default'];